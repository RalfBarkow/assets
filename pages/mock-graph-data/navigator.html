<div id=result><p>Navigating</p><div>

<script type=module>
  import {Graph} from 'http://ward.dojo.fed.wiki/assets/pages/mock-graph-data/graph.js'
  let g = await Graph.fetch('http://ward.dojo.fed.wiki/assets/pages/mock-graph-data/graphs/graph.json')

  let stride = {}
  let lineup = []

  stride.tally = {
    render: div => {
      let line = div.dataset.line
      let graph = lineup[line].data.graph
      let counts = graph.tally().nodes
      let keys = Object.keys(counts)
      div.innerHTML = `<hr><p>${keys.map(type =>
        `<span>${type}</span>: ${counts[type]}`).join("<br>")}</p>`
    },
    click: event => {
      let target = event.target
      if(target.tagName=='SPAN') {
        let parent = target.parentElement.parentElement
        let line = parent.dataset.line
        let graph = lineup[line].data.graph
        let name = target.innerText
        drill(line, stride.props,{props:graph.n(name).props()})
      }
    }
  }

  stride.props = {
    render: div => {
      let line = div.dataset.line
      let props = lineup[line].data.props
      div.innerHTML = `<hr><p>${props.join(`<br>`)}</p>`
    },
    click: event => {
      let target = event.target
      console.log(target.tagName)
    }
  }


  function drill(line,step,data) {
    while (lineup.length > line+1) {
      lineup.pop().div.remove()
    }
    let div = document.createElement('div')
    lineup.push({step,data,div})
    div.setAttribute('data-line',lineup.length-1)
    div.addEventListener('click', step.click)
    step.render(div)
    window.result.append(div)
  }


  drill(-1,stride.tally, {graph:g})

</script>