<div id=result>working</div>
<script type=module>
  import * as frame from 'http://code.fed.wiki/assets/v1/frame.js'
  const query = '%23Places%20within%201km%20of%20the%20Empire%20State%20Building%0ASELECT%20%3Fplace%20%3FplaceLabel%20%3Flocation%20%3FinstanceLabel%0AWHERE%0A%7B%0A%20%20wd%3AQ9188%20wdt%3AP625%20%3Floc%20.%0A%20%20SERVICE%20wikibase%3Aaround%20%7B%0A%20%20%20%20%20%20%3Fplace%20wdt%3AP625%20%3Flocation%20.%0A%20%20%20%20%20%20bd%3AserviceParam%20wikibase%3Acenter%20%3Floc%20.%0A%20%20%20%20%20%20bd%3AserviceParam%20wikibase%3Aradius%20%22.1%22%20.%0A%20%20%7D%0A%20%20OPTIONAL%20%7B%20%3Fplace%20wdt%3AP31%20%3Finstance%20%7D%0A%20%20SERVICE%20wikibase%3Alabel%20%7B%20bd%3AserviceParam%20wikibase%3Alanguage%20%22en%22%20%7D%0A%20%20BIND(geof%3Adistance(%3Floc%2C%20%3Flocation)%20as%20%3Fdist)%0A%7D%20ORDER%20BY%20%3Fdist'
  const url = `https://query.wikidata.org/sparql?format=json&query=${query}`
  const json = await fetch(url).then(res => res.json())
  console.log({query,json})

  window.domap = event => {
     const locations = json.results.bindings
      .map(binding => binding.location.value)
      .map(value => value.match(/(-?\d+\.\d+) (-?\d+\.\d+)\)/).slice(1,3))
    console.log(locations)
    const title = 'Map from WikiData'
    const text = locations.map(loc => `${loc[1]}, ${loc[0]}`).join("\n")
    const story = [{type:'map',text}]
    frame.open({title,story},false)
  }
  window.result.innerHTML = `
    <p>${json.results.bindings.length} Ã— (${json.head.vars.join(", ")})</p>
    <button onclick=domap(event)>Show Map</button>`
</script>