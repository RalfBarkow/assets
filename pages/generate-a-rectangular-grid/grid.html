
<html>

    <!--

         Generate a Rectangular Grid

         We generate a rectangular grid of sizeX * sizeY hexagonal neurons
         with normalized euclidian distance of 1 between each neighbor

    -->

<head>
  <meta charset="UTF-8">
</head>

<body style="background-color:white;">
  <div id="output">waiting</div><br>
  <div id="chart"></div>


  <script>

   let grid= {}
   let history = {}
   let drawing = false

   // from apl, https://aplwiki.com/wiki/Index_Generator
   // in js, https://stackoverflow.com/questions/3746725/how-to-create-an-array-containing-1-n
   const iota = n => [...new Array(n).keys()]


   // S I M U L A T I O N

   const delay = time => new Promise(res => setTimeout(res,time));
   const norm = mean => mean*(Math.random() + Math.random());

   // generate a rectangular grid of sizeX * sizeY hexagonal neurons
   // with normalized euclidian distance of 1 between each neighbor
   const generateGrid = (sizeX, sizeY) => {
       const margin = 1;

       const stepX = 1;
       // Pythagoras to the rescue
       const stepY = Math.sqrt(Math.pow(stepX, 2) - Math.pow(stepX / 2, 2));

       const getHexagon = (x, y) => ({
           pos: [x, y]
       });

       const generateRow = (y, i) =>
           iota(sizeX)
            .map(x => x + margin)
            .map(x => x + (i % 2 === 0 ? 0 : stepX / 2))
            .map(x => getHexagon(x, y));

       return (
          iota(sizeY)
            .map(y => y * stepY)
            .map(y => y + margin)
            .map((y, i) => generateRow(y, i))
            .flat()
       );
   };

   stream();

   async function stream () {
       while (true) {
           grid = generateGrid (13, 13);
           history = Date.now();
           await delay(norm(1200));
           refresh();
       };
   };


   // V I S U A L I Z A T I O N

   function refresh() {
       let text = JSON.stringify({grid, history}).replace(/"/g,'').replace(/},/g,"},\n")
       output.innerHTML = `<pre>${text}</pre>`
   }


  </script>
</body>
</html>
