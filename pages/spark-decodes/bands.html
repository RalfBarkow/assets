
<head><script src="https://cdn.plot.ly/plotly-latest.min.js"></script></head>
<body>
<pre id="result">working</pre>
<div id="graph" style="width:100%;height:90%;"></div>

<script>


// L I S T E N

const socket = new WebSocket('ws://localhost:4649/Spark')

socket.addEventListener('open', function (event) {
  socket.send('{"cmd":"subscribeToSpots","Enable":true}')
})

socket.addEventListener('message', (event) => {
    let msg = JSON.parse(event.data)
    tally(msg.spots)
})


// R E C O R D

let data = []

function tally(spots) {
  let type = 'scatter'
  let band = (Math.floor(spots[0].tunedfrequency/100000)/10).toFixed(1)
  let time = new Date()
  let count = spots.length
  let trace = data.find(trace => trace.name == band)
  if (trace == null) {
    trace = {name:band, type, x:[time], y:[count]}
    data.push(trace)
  } else {
    trace.x.push(time)
    trace.y.push(count)    
  }
  // result.innerHTML = JSON.stringify(data, null, 2)
  result.innerHTML = `Updated ${time}`
  plot()
}


// D I S P L A Y

var start = true
function plot () {
  Plotly.newPlot('graph', data)
  // } else {
    // var more = keys.map((k)=>[data[k]])
    // var when = keys.map(()=>[new Date()])
    // var iota = keys.map((_,k)=>k)
    // Plotly.extendTraces('graph', {x: when, y: more}, iota)
  // }
}


</script>
</body>